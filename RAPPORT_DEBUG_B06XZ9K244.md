# üîç Rapport de Debug : ASIN B06XZ9K244

## 1. Contenu de scoring_rules.yml sur marcus

**Fichier :** `/root/winner-machine/backend/app/config/scoring_rules.yml`

```yaml
min_margin_percent: 10
min_global_score_A: 50
min_global_score_B: 20
use_profit_per_day_rules: true
min_profit_per_day_A: 5.0  # EUR/jour minimum pour A_launch
min_profit_per_day_B: 1.0  # EUR/jour minimum pour B_review
```

‚úÖ **Configuration correcte** : La r√®gle profit/jour est bien activ√©e (`use_profit_per_day_rules: true`).

---

## 2. Stats apr√®s relance du scoring

**Commande :**
```bash
curl -X POST "http://localhost:8000/api/v1/jobs/scoring/run?force=true"
```

**R√©sultats :**
- ‚úÖ `pairs_scored: 65`
- ‚ùå `products_marked_selected: 0` (aucun A_launch)
- ‚úÖ `products_marked_scored: 2` (B_review)
- ‚úÖ `products_marked_rejected: 63` (C_drop)

---

## 3. Donn√©es du produit B06XZ9K244 (Winner Dashboard)

**ASIN :** B06XZ9K244

```json
{
  "asin": "B06XZ9K244",
  "title": "magilano SKYJO, Fun Card Game for Young and Least Young, Fun Game Parties in The Circle of Friends and Family.",
  "category": "France",
  "supplier_name": "AutoGenerated Supplier",
  "purchase_price": "5.99",
  "selling_price_target": "19.98",
  "amazon_fees_estimate": "7.50",
  "margin_absolute": "4.49",
  "margin_percent": "22.49",
  "gross_profit": "4.49",
  "gross_margin_percent": "22.49",
  "net_profit_estimated": "3.15",
  "estimated_sales_per_day": "1.97",
  "approx_profit_per_day": "6.2055",
  "global_score": "59.81",
  "decision": "B_review",
  "is_real_asin": true
}
```

---

## 4. Analyse du probl√®me

### ‚úÖ Valeurs calcul√©es (correctes)

- `margin_percent: 22.49%` (>= 10% ‚úÖ)
- `approx_profit_per_day: 6.2055 EUR` (>= 5.0 ‚úÖ)
- `net_profit_estimated: 3.15 EUR`
- `estimated_sales_per_day: 1.97`
- `global_score: 59.81` (>= 50 ‚úÖ)

### ‚ùå D√©cision (incorrecte)

- `decision: "B_review"` 
- **Devrait √™tre : "A_launch"** car `approx_profit_per_day (6.2055) >= min_profit_per_day_A (5.0)`

---

## 5. Logs ajout√©s pour debug

Les logs suivants ont √©t√© ajout√©s dans `ScoringService.score_product_option()` pour l'ASIN B06XZ9K244 :

1. **Lors du chargement de scoring_rules.yml** :
   - `=== CHARGEMENT scoring_rules.yml ===`
   - Toutes les valeurs de configuration

2. **Pour B06XZ9K244 sp√©cifiquement** :
   - `=== DEBUG B06XZ9K244: Configuration scoring_rules.yml ===`
   - `=== DEBUG B06XZ9K244: Valeurs calcul√©es ===`
   - `=== DEBUG B06XZ9K244: Seuils utilis√©s ===`
   - `=== DEBUG B06XZ9K244: Application r√®gle profit/jour ===`
   - `=== DEBUG B06XZ9K244: DECISION FINALE CHOISIE = {decision} ===`

---

## 6. Actions √† effectuer

1. **Relancer le scoring** avec les nouveaux logs
2. **R√©cup√©rer les logs d√©taill√©s** pour B06XZ9K244 depuis les logs Docker
3. **V√©rifier la DB** : compter les ProductScore pour B06XZ9K244
4. **Analyser la s√©quence de d√©cision** dans les logs

---

## 7. Prochaines √©tapes

Pour r√©cup√©rer les logs d√©taill√©s :

```bash
# Sur marcus
cd /root/winner-machine/infra
docker compose logs app 2>&1 | grep -E "CHARGEMENT|DEBUG B06XZ9K244" | tail -100
```

Pour v√©rifier la DB :

```sql
SELECT COUNT(*) FROM product_scores ps
JOIN product_candidates pc ON ps.product_candidate_id = pc.id
WHERE pc.asin = 'B06XZ9K244';
```

